<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invisalign Clear Aligners - Advanced Treatment Visualizer | SmileCare Dental</title>
    <meta name="description" content="Transform your smile with Invisalign clear aligners. Interactive progress simulator, cost calculator, and virtual consultation. See your future smile today!">
    <meta name="keywords" content="Invisalign, clear aligners, orthodontics, teeth straightening, smile makeover">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://smilecare.dental/invisalign">
    
    <!-- Preload critical fonts -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" as="style">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Critical CSS inlined for faster rendering -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --trust-blue: #0077BE;
            --clean-white: #FFFFFF;
            --accent-teal: #00A8A8;
            --soft-gray: #F5F5F5;
            --charcoal: #333333;
            --success-green: #28A745;
            --light-blue: #E6F3FF;
            --gradient-start: #0077BE;
            --gradient-end: #00A8A8;
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --border-radius: 10px;
            --shadow-light: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-medium: 0 5px 20px rgba(0,0,0,0.1);
            --shadow-heavy: 0 15px 40px rgba(0,0,0,0.1);
            --error-red: #dc3545;
            --warning-yellow: #ffc107;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: var(--charcoal);
            background-color: var(--clean-white);
            font-display: swap;
        }
        
        /* Critical above-the-fold styles */
        header {
            background: var(--clean-white);
            box-shadow: var(--shadow-light);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 5%;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--trust-blue);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }
        
        .nav-links a {
            text-decoration: none;
            color: var(--charcoal);
            font-weight: 500;
            transition: color var(--transition-fast);
        }
        
        .nav-links a:hover,
        .nav-links a:focus {
            color: var(--trust-blue);
            outline: none;
        }
        
        .cta-button {
            background: var(--success-green);
            color: var(--clean-white);
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            min-height: 44px; /* WCAG touch target */
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .cta-button:hover:not(:disabled),
        .cta-button:focus:not(:disabled) {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
            outline: 2px solid transparent;
        }
        
        .cta-button:focus-visible {
            outline: 2px solid var(--trust-blue);
            outline-offset: 2px;
        }
        
        .cta-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        
        .cta-button.secondary {
            background: var(--trust-blue);
        }
        
        .cta-button.secondary:hover:not(:disabled),
        .cta-button.secondary:focus:not(:disabled) {
            background: #005a8e;
        }
        
        /* Loading states */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--soft-gray);
            border-radius: 50%;
            border-top-color: var(--trust-blue);
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Button loading state */
        .cta-button.loading {
            color: transparent;
        }
        
        .cta-button.loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            top: 50%;
            left: 50%;
            margin-left: -10px;
            margin-top: -10px;
            border: 2px solid var(--clean-white);
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }
        
        /* Success state */
        .cta-button.success {
            background: var(--success-green);
        }
        
        .cta-button.success::after {
            content: '✓';
            position: absolute;
            font-size: 1.5rem;
            color: var(--clean-white);
            animation: checkmark 0.3s ease-out;
        }
        
        @keyframes checkmark {
            from {
                transform: scale(0);
            }
            to {
                transform: scale(1);
            }
        }
        
        /* Error states */
        .error {
            color: var(--error-red);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }
        
        .form-group input:invalid:not(:placeholder-shown) {
            border-color: var(--error-red);
        }
        
        .form-group input:valid:not(:placeholder-shown) {
            border-color: var(--success-green);
        }
        
        /* Success messages */
        .success-message {
            background: var(--success-green);
            color: var(--clean-white);
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-top: 1rem;
            text-align: center;
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Hero Section - Optimized for conversion */
        .hero {
            background: linear-gradient(135deg, rgba(0,119,190,0.08) 0%, rgba(0,168,168,0.08) 100%);
            padding: 4rem 5%;
            position: relative;
        }
        
        .hero-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            align-items: center;
        }
        
        .hero-text h1 {
            font-size: clamp(2rem, 4vw, 2.5rem);
            color: var(--trust-blue);
            margin-bottom: 1rem;
            line-height: 1.2;
            font-weight: 700;
        }
        
        .hero-text p {
            font-size: 1.25rem;
            color: var(--charcoal);
            margin-bottom: 2rem;
        }
        
        .hero-buttons {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        /* Virtual consultation form */
        .virtual-consultation {
            background: var(--clean-white);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow-heavy);
            position: relative;
        }
        
        .consultation-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .consultation-header h2 {
            color: var(--trust-blue);
            font-size: 1.5rem;
        }
        
        .live-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--success-green);
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .live-dot {
            width: 10px;
            height: 10px;
            background: var(--success-green);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }
        
        .consultation-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .form-group label {
            font-weight: 600;
            color: var(--charcoal);
        }
        
        .form-group input,
        .form-group select {
            padding: 0.75rem;
            border: 2px solid var(--soft-gray);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: border-color var(--transition-fast);
            min-height: 44px;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--trust-blue);
            box-shadow: 0 0 0 3px rgba(0, 119, 190, 0.1);
        }
        
        /* Accessibility improvements */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* Skip link for keyboard users */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 6px;
            background: var(--trust-blue);
            color: var(--clean-white);
            padding: 8px;
            text-decoration: none;
            border-radius: 4px;
            z-index: 9999;
        }
        
        .skip-link:focus {
            top: 6px;
        }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .hero-content {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .hero-text h1 {
                font-size: 2rem;
            }
        }
        
        /* High contrast mode support */
        @media (prefers-contrast: high) {
            :root {
                --trust-blue: #0066CC;
                --soft-gray: #E8E8E8;
                --light-blue: #CCE5FF;
            }
        }
        
        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
    
    <!-- Schema markup for better SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "MedicalBusiness",
        "name": "SmileCare Dental",
        "description": "Advanced Invisalign clear aligner treatment with 3D visualization",
        "url": "https://smilecare.dental",
        "telephone": "+1-555-SMILE-99",
        "medicalSpecialty": "Orthodontics",
        "priceRange": "$3000-$7000",
        "paymentAccepted": ["Cash", "Credit Card", "Insurance", "Financing"]
    }
    </script>
</head>
<body>
    <!-- Skip link for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    
    <!-- Header with improved navigation -->
    <header role="banner">
        <nav role="navigation" aria-label="Main navigation">
            <div class="logo">
                <span role="img" aria-label="Tooth icon" style="font-size: 1.5rem;">🦷</span>
                SmileCare Dental
            </div>
            <ul class="nav-links">
                <li><a href="#simulator" aria-describedby="simulator-desc">Simulator</a></li>
                <li><a href="#compare" aria-describedby="compare-desc">Compare</a></li>
                <li><a href="#cost" aria-describedby="cost-desc">Cost Calculator</a></li>
                <li><a href="#progress" aria-describedby="progress-desc">Progress</a></li>
                <li><a href="#testimonials" aria-describedby="testimonials-desc">Results</a></li>
            </ul>
            <a href="#consultation" class="cta-button" aria-describedby="cta-desc" onclick="scrollToConsultation(event)">
                Start Virtual Consultation
            </a>
        </nav>
        
        <!-- Hidden descriptions for screen readers -->
        <div class="sr-only">
            <div id="simulator-desc">Interactive smile simulation tool</div>
            <div id="compare-desc">Compare Invisalign with traditional braces</div>
            <div id="cost-desc">Calculate treatment costs and payment options</div>
            <div id="progress-desc">Track your treatment progress</div>
            <div id="testimonials-desc">View patient success stories</div>
            <div id="cta-desc">Start your free consultation process</div>
        </div>
    </header>

    <!-- Main content with improved structure -->
    <main id="main-content" role="main">
        <!-- Hero Section with Virtual Consultation -->
        <section class="hero" aria-labelledby="hero-heading">
            <div class="hero-content">
                <div class="hero-text">
                    <h1 id="hero-heading">
                        Transform Your Smile with Invisalign® Clear Aligners
                    </h1>
                    <p>
                        Experience the future of orthodontics with our advanced treatment visualizer and personalized care plans
                    </p>
                    <div class="hero-buttons">
                        <a href="#simulator" class="cta-button" onclick="scrollToSimulator(event)">
                            <span aria-hidden="true">🔬</span>
                            Try Smile Simulator
                        </a>
                        <a href="#quiz" class="cta-button secondary" onclick="scrollToQuiz(event)">
                            <span aria-hidden="true">📝</span>
                            Take Lifestyle Quiz
                        </a>
                    </div>
                </div>
                
                <div class="virtual-consultation" role="form" aria-labelledby="consultation-heading">
                    <div class="consultation-header">
                        <h2 id="consultation-heading">Start Your Virtual Consultation</h2>
                        <div class="live-indicator" aria-live="polite">
                            <span class="live-dot" aria-hidden="true"></span>
                            <span>Live Expert Available</span>
                        </div>
                    </div>
                    <form class="consultation-form" id="consultationForm" novalidate>
                        <div class="form-group">
                            <label for="name">Your Name *</label>
                            <input type="text" id="name" name="name" required aria-required="true" aria-describedby="name-error">
                            <div id="name-error" class="error" role="alert" aria-live="polite"></div>
                        </div>
                        <div class="form-group">
                            <label for="email">Email Address *</label>
                            <input type="email" id="email" name="email" required aria-required="true" aria-describedby="email-error">
                            <div id="email-error" class="error" role="alert" aria-live="polite"></div>
                        </div>
                        <div class="form-group">
                            <label for="phone">Phone Number *</label>
                            <input type="tel" id="phone" name="phone" required aria-required="true" aria-describedby="phone-error">
                            <div id="phone-error" class="error" role="alert" aria-live="polite"></div>
                        </div>
                        <div class="form-group">
                            <label for="concern">Main Concern *</label>
                            <select id="concern" name="concern" required aria-required="true" aria-describedby="concern-error">
                                <option value="">Select your concern</option>
                                <option value="crowding">Crowded Teeth</option>
                                <option value="gaps">Gaps Between Teeth</option>
                                <option value="overbite">Overbite</option>
                                <option value="underbite">Underbite</option>
                                <option value="crossbite">Crossbite</option>
                            </select>
                            <div id="concern-error" class="error" role="alert" aria-live="polite"></div>
                        </div>
                        <div class="form-group">
                            <label for="timeline">Desired Timeline *</label>
                            <select id="timeline" name="timeline" required aria-required="true" aria-describedby="timeline-error">
                                <option value="">Select timeline</option>
                                <option value="asap">As soon as possible</option>
                                <option value="3months">Within 3 months</option>
                                <option value="6months">Within 6 months</option>
                                <option value="exploring">Just exploring</option>
                            </select>
                            <div id="timeline-error" class="error" role="alert" aria-live="polite"></div>
                        </div>
                        <button type="submit" class="cta-button" style="width: 100%;" aria-describedby="submit-help">
                            <span class="button-text">Get Instant Treatment Plan</span>
                        </button>
                        <div id="submit-help" class="sr-only">Submit form to receive personalized treatment recommendations</div>
                        <div id="formMessage" role="alert" aria-live="polite"></div>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer with proper structure -->
    <footer role="contentinfo" style="background: var(--charcoal); color: var(--clean-white); padding: 3rem 5%; text-align: center;">
        <p style="margin-bottom: 1rem;">© 2024 SmileCare Dental. All rights reserved.</p>
        <p style="font-size: 0.875rem; opacity: 0.8;">Invisalign® is a registered trademark of Align Technology, Inc.</p>
    </footer>

    <!-- Enhanced JavaScript with production-ready features -->
    <script>
        // API Configuration
        const API_BASE_URL = 'https://api.smilecare.dental';
        const API_ENDPOINTS = {
            bookAppointment: '/api/book-appointment',
            contact: '/api/contact',
            checkInsurance: '/api/insurance/check',
            calculateCost: '/api/cost-calculator'
        };

        // Google Analytics 4 tracking
        function trackEvent(eventName, parameters = {}) {
            if (typeof gtag !== 'undefined') {
                gtag('event', eventName, {
                    event_category: 'engagement',
                    event_label: 'invisalign_page',
                    ...parameters
                });
            }
            console.log('Track event:', eventName, parameters);
        }

        // Enhanced form validation
        function validateForm(form) {
            const inputs = form.querySelectorAll('input[required], select[required]');
            let isValid = true;
            
            inputs.forEach(input => {
                const errorEl = document.getElementById(input.id + '-error');
                const value = input.value.trim();
                
                if (!value) {
                    errorEl.textContent = `${input.labels[0].textContent.replace('*', '')} is required`;
                    input.setAttribute('aria-invalid', 'true');
                    isValid = false;
                } else if (input.type === 'email' && !isValidEmail(value)) {
                    errorEl.textContent = 'Please enter a valid email address';
                    input.setAttribute('aria-invalid', 'true');
                    isValid = false;
                } else if (input.type === 'tel' && !isValidPhone(value)) {
                    errorEl.textContent = 'Please enter a valid phone number';
                    input.setAttribute('aria-invalid', 'true');
                    isValid = false;
                } else {
                    errorEl.textContent = '';
                    input.setAttribute('aria-invalid', 'false');
                }
            });
            
            return isValid;
        }

        function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
        }

        function isValidPhone(phone) {
            return /^[\d\s\-\+\(\)]+$/.test(phone) && phone.replace(/\D/g, '').length >= 10;
        }

        // Enhanced consultation form submission with API integration
        document.getElementById('consultationForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            if (!validateForm(this)) {
                trackEvent('form_validation_failed', { form: 'consultation' });
                return;
            }
            
            const button = this.querySelector('button[type="submit"]');
            const buttonText = button.querySelector('.button-text');
            const originalText = buttonText.textContent;
            
            // Show loading state
            button.disabled = true;
            button.classList.add('loading');
            buttonText.textContent = 'Submitting...';
            
            // Collect form data
            const formData = new FormData(this);
            const data = {
                name: formData.get('name'),
                email: formData.get('email'),
                phone: formData.get('phone'),
                concern: formData.get('concern'),
                timeline: formData.get('timeline'),
                source: 'invisalign_page',
                timestamp: new Date().toISOString()
            };
            
            try {
                // Make API call
                const response = await fetch(API_ENDPOINTS.contact, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                
                const result = await response.json();
                
                // Track successful submission
                trackEvent('form_submit_success', {
                    form: 'consultation',
                    concern: data.concern,
                    timeline: data.timeline
                });
                
                // Show success state
                button.classList.remove('loading');
                button.classList.add('success');
                buttonText.textContent = 'Success!';
                
                // Show success message
                const messageEl = document.getElementById('formMessage');
                messageEl.className = 'success-message';
                messageEl.innerHTML = `
                    <strong>Thank you, ${data.name}!</strong><br>
                    A specialist will contact you within 24 hours.<br>
                    Your confirmation number is: ${result.confirmationId || 'INV-' + Date.now()}
                `;
                
                // Reset form after delay
                setTimeout(() => {
                    this.reset();
                    button.classList.remove('success');
                    button.disabled = false;
                    buttonText.textContent = originalText;
                }, 3000);
                
            } catch (error) {
                console.error('Submission error:', error);
                
                // Track error
                trackEvent('form_submit_error', {
                    form: 'consultation',
                    error: error.message
                });
                
                // Show error state
                button.classList.remove('loading');
                button.disabled = false;
                buttonText.textContent = originalText;
                
                const messageEl = document.getElementById('formMessage');
                messageEl.className = 'error';
                messageEl.textContent = 'Something went wrong. Please try again or call us at 1-555-SMILE-99';
            }
        });

        // Real-time form validation
        document.querySelectorAll('#consultationForm input, #consultationForm select').forEach(input => {
            input.addEventListener('blur', function() {
                if (this.hasAttribute('required')) {
                    validateField(this);
                }
            });
        });

        function validateField(field) {
            const errorEl = document.getElementById(field.id + '-error');
            const value = field.value.trim();
            
            if (!value) {
                errorEl.textContent = `${field.labels[0].textContent.replace('*', '')} is required`;
                field.setAttribute('aria-invalid', 'true');
            } else if (field.type === 'email' && !isValidEmail(value)) {
                errorEl.textContent = 'Please enter a valid email address';
                field.setAttribute('aria-invalid', 'true');
            } else if (field.type === 'tel' && !isValidPhone(value)) {
                errorEl.textContent = 'Please enter a valid phone number';
                field.setAttribute('aria-invalid', 'true');
            } else {
                errorEl.textContent = '';
                field.setAttribute('aria-invalid', 'false');
            }
        }

        // Smooth scrolling with loading states
        function scrollToElement(elementId, event) {
            if (event) event.preventDefault();
            
            const element = document.querySelector(elementId);
            if (element) {
                element.scrollIntoView({ behavior: 'smooth', block: 'start' });
                // Set focus for accessibility
                element.setAttribute('tabindex', '-1');
                element.focus();
                element.removeAttribute('tabindex');
            }
        }

        function scrollToConsultation(event) {
            trackEvent('cta_click', { location: 'header', action: 'consultation' });
            scrollToElement('#consultation', event);
        }

        function scrollToSimulator(event) {
            trackEvent('cta_click', { location: 'hero', action: 'simulator' });
            scrollToElement('#simulator', event);
        }

        function scrollToQuiz(event) {
            trackEvent('cta_click', { location: 'hero', action: 'quiz' });
            scrollToElement('#quiz', event);
        }

        // Mobile touch event optimization
        if ('ontouchstart' in window) {
            document.querySelectorAll('.cta-button').forEach(button => {
                button.addEventListener('touchstart', function() {
                    this.classList.add('touch-active');
                });
                
                button.addEventListener('touchend', function() {
                    this.classList.remove('touch-active');
                });
            });
        }

        // Keyboard navigation improvements
        document.addEventListener('keydown', function(e) {
            // ESC key closes any open modals
            if (e.key === 'Escape') {
                const activeModal = document.querySelector('.modal.active');
                if (activeModal) {
                    closeModal(activeModal);
                }
            }
        });

        // Performance monitoring
        if ('PerformanceObserver' in window) {
            const observer = new PerformanceObserver((list) => {
                list.getEntries().forEach((entry) => {
                    if (entry.entryType === 'largest-contentful-paint') {
                        console.log('LCP:', entry.startTime);
                        trackEvent('performance_lcp', { value: Math.round(entry.startTime) });
                    }
                });
            });
            observer.observe({entryTypes: ['largest-contentful-paint']});
        }

        // Error handling
        window.addEventListener('error', function(event) {
            console.error('JavaScript error:', event.error);
            trackEvent('javascript_error', {
                message: event.error.message,
                source: event.filename,
                line: event.lineno
            });
        });

        // Page visibility tracking
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                trackEvent('page_hidden');
            } else {
                trackEvent('page_visible');
            }
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Track page view
            trackEvent('page_view', { page_title: document.title });
            
            // Initialize any third-party services
            initializeChat();
            initializeAnalytics();
        });

        function initializeChat() {
            // Initialize live chat widget if available
            if (window.LiveChat) {
                window.LiveChat.init({
                    license: 'SMILECARE_LICENSE_KEY',
                    group: 'invisalign_specialists'
                });
            }
        }

        function initializeAnalytics() {
            // Additional analytics initialization
            console.log('Analytics initialized');
        }
    </script>

    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=GA_MEASUREMENT_ID"></script>

    <!-- Google Analytics 4 -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-XXXXXXXXXX');
    </script>

    <script>
        // Performance optimized JavaScript with debouncing
        const debounce = (func, wait) => {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        };

        // GA4 Event Tracking Helper
        function trackEvent(eventName, parameters = {}) {
            if (typeof gtag !== 'undefined') {
                gtag('event', eventName, {
                    'service_name': document.querySelector('meta[name="service-name"]')?.content || 'unknown',
                    ...parameters
                });
            }
        }

        // API Configuration
        const API_CONFIG = {
            bookAppointment: '/api/book-appointment',
            contact: '/api/contact',
            timeout: 10000
        };

        // Loading State Manager
        class LoadingStateManager {
            static setLoading(element, isLoading, loadingText = 'Loading...') {
                if (isLoading) {
                    element.dataset.originalText = element.textContent;
                    element.textContent = loadingText;
                    element.disabled = true;
                    element.classList.add('loading');
                } else {
                    element.textContent = element.dataset.originalText || element.textContent;
                    element.disabled = false;
                    element.classList.remove('loading');
                }
            }
        }

        // Enhanced Form Submission with API integration
        async function submitAppointment(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            const button = form.querySelector('button[type="submit"]');
            const serviceName = document.querySelector('meta[name="service-name"]')?.content || 'unknown';
            
            // Validate required fields
            const requiredFields = form.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.style.borderColor = 'var(--error-red)';
                    field.classList.add('error');
                    isValid = false;
                } else {
                    field.style.borderColor = 'var(--border-light)';
                    field.classList.remove('error');
                }
            });
            
            if (!isValid) {
                showNotification('Please fill in all required fields.', 'error');
                trackEvent('form_validation_error', { form_type: 'appointment' });
                return;
            }
            
            // Show loading state
            LoadingStateManager.setLoading(button, true, 'Submitting...');
            
            // Track form submission attempt
            trackEvent(`submit_appointment_${serviceName}`, {
                urgency: formData.get('urgency') || 'normal',
                service_interest: formData.get('service-interest')
            });
            
            try {
                // Create appointment data object
                const appointmentData = {
                    name: formData.get('name'),
                    email: formData.get('email'),
                    phone: formData.get('phone'),
                    preferredDate: formData.get('preferred-date'),
                    preferredTime: formData.get('preferred-time'),
                    serviceInterest: formData.get('service-interest'),
                    urgency: formData.get('urgency'),
                    message: formData.get('message'),
                    source: `${serviceName}-page`,
                    timestamp: new Date().toISOString()
                };
                
                // Make API call with timeout
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), API_CONFIG.timeout);
                
                const response = await fetch(API_CONFIG.bookAppointment, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(appointmentData),
                    signal: controller.signal
                });
                
                clearTimeout(timeoutId);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                // Track successful submission
                trackEvent(`appointment_success_${serviceName}`, {
                    appointment_id: result.appointmentId,
                    urgency: appointmentData.urgency
                });
                
                showNotification(`Thank you, ${appointmentData.name}! Your appointment request has been received. We'll contact you within 1 hour to confirm your appointment.`, 'success');
                
                // Reset form
                form.reset();
                
                // Reset any custom selectors
                document.querySelectorAll('.urgency-option, .symptom-button').forEach(option => {
                    option.classList.remove('selected');
                    option.setAttribute('aria-checked', 'false');
                });
                
            } catch (error) {
                console.error('Appointment submission error:', error);
                
                // Track error
                trackEvent(`appointment_error_${serviceName}`, {
                    error_type: error.name,
                    error_message: error.message
                });
                
                if (error.name === 'AbortError') {
                    showNotification('Request timed out. Please check your connection and try again.', 'error');
                } else {
                    showNotification('Appointment submission failed. Please try again or call (555) 123-4567.', 'error');
                }
            } finally {
                LoadingStateManager.setLoading(button, false);
            }
        }

        // Enhanced notification system
        function showNotification(message, type = 'info') {
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => notification.remove());
            
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.setAttribute('data-type', type);
            notification.style.cssText = `
                position: fixed; 
                top: 20px; 
                right: 20px; 
                background: ${type === 'error' ? 'var(--error-red)' : 'var(--success-green)'}; 
                color: white; 
                padding: 1rem 2rem; 
                border-radius: 25px; 
                z-index: 10001;
                box-shadow: 0 4px 20px rgba(0,0,0,0.2);
                max-width: 350px;
                animation: slideIn 0.3s ease-out;
                font-family: inherit;
                font-weight: 500;
                line-height: 1.4;
                display: flex;
                align-items: center;
                gap: 10px;
            `;
            
            notification.textContent = message;
            notification.setAttribute('role', 'alert');
            notification.setAttribute('aria-live', 'assertive');
            
            document.body.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.style.animation = 'slideOut 0.3s ease-in';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }
            }, 5000);
        }

        // Initialize all CTA buttons with proper functionality
        function initializeCTAButtons() {
            const serviceName = document.querySelector('meta[name="service-name"]')?.content || 'unknown';
            
            document.querySelectorAll('.cta-button, .btn-primary, .btn-schedule, .btn-book, .appointment-btn, a[class*="button"]').forEach(button => {
                if (!button.hasAttribute('data-initialized')) {
                    button.setAttribute('data-initialized', 'true');
                    
                    button.addEventListener('click', async function(e) {
                        // Don't prevent default for external links
                        if (!this.href || this.href.startsWith('#') || this.href.includes(window.location.hostname)) {
                            e.preventDefault();
                        }
                        
                        const buttonText = this.textContent.toLowerCase();
                        const href = this.getAttribute('href');
                        
                        // Track button click
                        trackEvent(`click_service_cta_${serviceName}`, {
                            button_text: this.textContent,
                            button_location: this.closest('section')?.className || 'unknown'
                        });
                        
                        // Handle different button types
                        if (href && href.startsWith('#')) {
                            // Internal anchor link - scroll to section
                            const target = document.querySelector(href);
                            if (target) {
                                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                // Focus for accessibility
                                if (target.hasAttribute('tabindex') || target.querySelector('input, button')) {
                                    setTimeout(() => {
                                        const focusable = target.querySelector('input, button') || target;
                                        focusable.focus();
                                    }, 500);
                                }
                            }
                        } else if (buttonText.includes('schedule') || buttonText.includes('book') || buttonText.includes('appointment')) {
                            // Appointment booking button
                            const schedulerSection = document.querySelector('#scheduler, #appointment, .appointment-form, .booking-form');
                            if (schedulerSection) {
                                schedulerSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                setTimeout(() => {
                                    const firstInput = schedulerSection.querySelector('input');
                                    if (firstInput) firstInput.focus();
                                }, 500);
                            } else {
                                // If no scheduler section, go to appointment page
                                window.location.href = '/book-appointment.html';
                            }
                        } else if (buttonText.includes('call') || buttonText.includes('phone')) {
                            // Phone call button
                            window.location.href = 'tel:5551234567';
                        } else if (buttonText.includes('insurance')) {
                            // Insurance verification
                            await handleInsuranceVerification(this);
                        } else if (buttonText.includes('quote') || buttonText.includes('consultation')) {
                            // Quote/consultation request
                            await handleQuoteRequest(this);
                        }
                    });
                    
                    // Add touch event handling for mobile
                    button.addEventListener('touchstart', function() {
                        this.classList.add('touch-active');
                    });
                    
                    button.addEventListener('touchend', function() {
                        setTimeout(() => {
                            this.classList.remove('touch-active');
                        }, 300);
                    });
                }
            });
        }

        // Initialize phone links with tracking
        function initializePhoneLinks() {
            const serviceName = document.querySelector('meta[name="service-name"]')?.content || 'unknown';
            
            document.querySelectorAll('a[href^="tel:"]').forEach(link => {
                if (!link.hasAttribute('data-initialized')) {
                    link.setAttribute('data-initialized', 'true');
                    
                    link.addEventListener('click', function(e) {
                        // Track phone click
                        trackEvent(`click_phone_${serviceName}`, {
                            phone_location: this.closest('section')?.className || 'unknown',
                            is_emergency: this.classList.contains('emergency-phone')
                        });
                    });
                }
            });
        }

        // Initialize floating CTA button
        function initializeFloatingCTA() {
            const floatingCTA = document.querySelector('.floating-cta, .floating-btn, .sticky-cta');
            if (floatingCTA && !floatingCTA.hasAttribute('data-initialized')) {
                floatingCTA.setAttribute('data-initialized', 'true');
                
                // Add scroll-based visibility
                let lastScrollTop = 0;
                window.addEventListener('scroll', debounce(function() {
                    const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                    
                    if (scrollTop > 300) {
                        floatingCTA.style.opacity = '1';
                        floatingCTA.style.transform = 'scale(1)';
                    } else {
                        floatingCTA.style.opacity = '0';
                        floatingCTA.style.transform = 'scale(0.8)';
                    }
                    
                    // Hide when scrolling down, show when scrolling up
                    if (scrollTop > lastScrollTop && scrollTop > 600) {
                        floatingCTA.style.transform = 'translateY(100px)';
                    } else {
                        floatingCTA.style.transform = 'translateY(0)';
                    }
                    
                    lastScrollTop = scrollTop;
                }, 100));
                
                // Add initial styles
                floatingCTA.style.transition = 'all 0.3s ease';
                floatingCTA.style.opacity = '0';
                floatingCTA.style.transform = 'scale(0.8)';
            }
        }

        // Handle insurance verification
        async function handleInsuranceVerification(button) {
            const serviceName = document.querySelector('meta[name="service-name"]')?.content || 'unknown';
            LoadingStateManager.setLoading(button, true, 'Verifying...');
            
            try {
                const response = await fetch(API_CONFIG.contact, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        type: 'insurance_verification',
                        source: `${serviceName}-page`,
                        timestamp: new Date().toISOString()
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Verification failed');
                }
                
                trackEvent(`insurance_verification_success_${serviceName}`);
                showNotification('Insurance verification initiated! Our team will contact you within 30 minutes.', 'success');
                
            } catch (error) {
                trackEvent(`insurance_verification_error_${serviceName}`);
                showNotification('Unable to process verification. Please call (555) 123-4567.', 'error');
            } finally {
                LoadingStateManager.setLoading(button, false);
            }
        }

        // Handle quote/consultation requests
        async function handleQuoteRequest(button) {
            const serviceName = document.querySelector('meta[name="service-name"]')?.content || 'unknown';
            LoadingStateManager.setLoading(button, true, 'Processing...');
            
            try {
                const response = await fetch(API_CONFIG.contact, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        type: 'quote_request',
                        service: serviceName,
                        source: `${serviceName}-page`,
                        timestamp: new Date().toISOString()
                    })
                });
                
                if (!response.ok) {
                    throw new Error('Request failed');
                }
                
                trackEvent(`quote_request_success_${serviceName}`);
                showNotification('Quote request received! We\'ll email you a personalized quote within 2 hours.', 'success');
                
            } catch (error) {
                trackEvent(`quote_request_error_${serviceName}`);
                showNotification('Unable to process request. Please call (555) 123-4567.', 'error');
            } finally {
                LoadingStateManager.setLoading(button, false);
            }
        }

        // Initialize on DOM content loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize all interactive elements
            initializeCTAButtons();
            initializePhoneLinks();
            initializeFloatingCTA();
            
            // Set minimum date for appointment inputs
            const today = new Date().toISOString().split('T')[0];
            document.querySelectorAll('input[type="date"]').forEach(input => {
                input.setAttribute('min', today);
            });
            
            // Initialize form submit handlers
            document.querySelectorAll('form').forEach(form => {
                // Check if it's an appointment form
                const hasAppointmentFields = form.querySelector('input[name="name"]') && 
                                            form.querySelector('input[name="email"]') &&
                                            form.querySelector('input[name="phone"]');
                
                if (hasAppointmentFields || form.classList.contains('appointment-form') || 
                    form.classList.contains('booking-form') || form.hasAttribute('data-appointment')) {
                    form.addEventListener('submit', submitAppointment);
                }
            });
            
            // Smooth scroll for anchor links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });
        });

        // Add CSS animations and button states
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }
            
            /* Loading state for buttons */
            button.loading, .loading {
                position: relative;
                color: transparent !important;
            }
            
            button.loading::after, .loading::after {
                content: '';
                position: absolute;
                width: 16px;
                height: 16px;
                top: 50%;
                left: 50%;
                margin-left: -8px;
                margin-top: -8px;
                border: 2px solid #ffffff;
                border-radius: 50%;
                border-top-color: transparent;
                animation: spin 0.8s linear infinite;
            }
            
            /* Touch active state for mobile */
            .touch-active {
                transform: scale(0.95);
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            }
            
            /* Success/Error states for form fields */
            input.success, select.success, textarea.success {
                border-color: #28A745 !important;
                background-color: rgba(40, 167, 69, 0.05);
            }
            
            input.error, select.error, textarea.error {
                border-color: #DC3545 !important;
                background-color: rgba(220, 53, 69, 0.05);
            }
            
            /* Notification improvements */
            .notification::before {
                content: '✓';
                font-size: 1.2rem;
                font-weight: bold;
            }
            
            .notification[data-type="error"]::before {
                content: '✕';
            }
            
            /* Focus visible improvements */
            :focus-visible {
                outline: 3px solid #0077BE;
                outline-offset: 2px;
            }
            
            /* Smooth transitions for all interactive elements */
            button, a, input, select, textarea {
                transition: all 0.2s ease;
            }
            
            /* Ensure buttons are clickable */
            button, .cta-button, .btn-primary, .btn-schedule {
                cursor: pointer;
                user-select: none;
            }
        `;
        document.head.appendChild(style);
    </script>

</body>
</html>